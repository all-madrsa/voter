<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>A6 Voter Slip</title>

<style>
body { font-family: Arial; background:#e7e7e7; margin:0; padding:0; }
.container { width: 360px; margin:20px auto; background:white; padding:15px; 
    border-radius:10px; box-shadow:0 0 5px #aaa; }

#previewImg { width:120px; height:150px; object-fit:cover; border:1px solid #333; 
    display:block; margin:10px auto; }

input, select { width:100%; padding:8px; margin-top:6px; border-radius:5px; 
    border:1px solid #999; }
button { width:100%; padding:10px; margin-top:10px; border:none; background:#0066ff; 
    color:white; border-radius:5px; cursor:pointer; }
button:hover { background:#004ecc; }

#slipArea { width: 100%; padding:10px; margin-top:20px; border:2px solid #000; 
    border-radius:8px; background:white; }
.row { margin-bottom:6px; font-size:15px; }
strong { width:140px; display:inline-block; }
.title { text-align:center; font-size:18px; font-weight:bold; margin-bottom:10px; }
</style>

</head>
<body>

<div class="container">

<h3 style="text-align:center;">A6 Voter Slip Generator</h3>

<input type="file" id="imgUpload" accept="image/*" onchange="saveImage(event)">
<img id="previewImg">

<input id="fname" placeholder="First Name">
<input id="lname" placeholder="Last Name">
<input id="rfname" placeholder="Relative First Name">
<input id="rlname" placeholder="Relative Last Name">
<input id="age" placeholder="Age">
<select id="gender">
    <option value="">Gender</option>
    <option>Male</option>
    <option>Female</option>
</select>
<input id="epic" placeholder="EPIC Number">
<input id="state" placeholder="State">
<input id="parliament" placeholder="Parliamentary Constituency">
<input id="assembly" placeholder="Assembly Constituency">
<input id="polling" placeholder="Polling Station">
<input id="partno" placeholder="Part Number">
<input id="serial" placeholder="Serial Number">
<input id="date" placeholder="Polling Date">

<button onclick="generateSlip()">Generate Slip</button>
<button onclick="downloadPDF()">Download A6 PDF</button>

<div id="slipArea"></div>

</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>

// Load saved image + data
window.onload = function () {
    let img = localStorage.getItem("voterImg");
    if (img) document.getElementById("previewImg").src = img;

    let fields = ["fname","lname","rfname","rlname","age","gender","epic","state",
                  "parliament","assembly","polling","partno","serial","date"];

    fields.forEach(id=>{
        if(localStorage.getItem(id)) document.getElementById(id).value = localStorage.getItem(id);
    });
};

// Save Image
function saveImage(event) {
    const file = event.target.files[0];
    const reader = new FileReader();
    reader.onload = function(){
        localStorage.setItem("voterImg", reader.result);
        document.getElementById("previewImg").src = reader.result;
    }
    reader.readAsDataURL(file);
}

// Save Text Data
function autoStore() {
    let fields = ["fname","lname","rfname","rlname","age","gender","epic","state",
                  "parliament","assembly","polling","partno","serial","date"];

    fields.forEach(id=>{
        localStorage.setItem(id, document.getElementById(id).value);
    });
}
document.querySelectorAll("input,select").forEach(e=>e.addEventListener("input",autoStore));

// Generate Slip
function generateSlip() {

    let pimg = document.getElementById("previewImg").src;

    let html = `
        <div class="title">VOTER INFORMATION SLIP</div>
        <img src="${pimg}" style="width:120px;height:150px;object-fit:cover;border:1px solid #000;margin:auto;display:block;">
        <div class="row"><strong>Name:</strong> ${fname.value} ${lname.value}</div>
        <div class="row"><strong>Relative Name:</strong> ${rfname.value} ${rlname.value}</div>
        <div class="row"><strong>Age:</strong> ${age.value}</div>
        <div class="row"><strong>Gender:</strong> ${gender.value}</div>
        <div class="row"><strong>EPIC No:</strong> ${epic.value}</div>
        <div class="row"><strong>State:</strong> ${state.value}</div>
        <div class="row"><strong>Parliamentary:</strong> ${parliament.value}</div>
        <div class="row"><strong>Assembly:</strong> ${assembly.value}</div>
        <div class="row"><strong>Polling Station:</strong> ${polling.value}</div>
        <div class="row"><strong>Part No:</strong> ${partno.value}</div>
        <div class="row"><strong>Serial No:</strong> ${serial.value}</div>
        <div class="row"><strong>Polling Date:</strong> ${date.value}</div>
    `;

    document.getElementById("slipArea").innerHTML = html;
}

// Download A6 PDF
async function downloadPDF() {

    if (!slipArea.innerHTML.trim()) {
        alert("First click on Generate Slip.");
        return;
    }

    const { jsPDF } = window.jspdf;

    const canvas = await html2canvas(document.getElementById("slipArea"), { scale:3 });
    const img = canvas.toDataURL("image/jpeg",1.0);

    let pdf = new jsPDF("p", "mm", [105, 148]);
    pdf.addImage(img, "JPEG", 3, 3, 99, 142);
    pdf.save("VoterSlip-A6.pdf");
}

</script>

</body>
</html>
