<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>PDF + Image Merge Tool</title>

<!-- PDF.js CDN -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.12.313/pdf.min.js"></script>

<style>
    body {
        font-family: Arial, sans-serif;
        background: #e8e8e8;
        text-align: center;
        padding: 20px;
    }

    h2 {
        margin-bottom: 20px;
    }

    .upload-box {
        background: white;
        padding: 20px;
        border-radius: 15px;
        width: 90%;
        max-width: 450px;
        margin: auto;
        box-shadow: 0 0 10px rgba(0,0,0,0.2);
    }

    input {
        margin: 10px;
    }

    .btn {
        padding: 14px 30px;
        font-size: 18px;
        border: none;
        color: white;
        background: #007bff;
        border-radius: 10px;
        cursor: pointer;
        margin: 10px;
    }

    .btn:hover {
        background: #0056b3;
    }

    .output-box {
        margin-top: 25px;
    }

    img.merged {
        max-width: 90%;
        border: 2px solid #000;
        border-radius: 10px;
        margin-top: 20px;
    }
</style>
</head>

<body>

<h2>PDF + Image Mixer (Merge Tool)</h2>

<div class="upload-box">

    <label><b>Select PDF File:</b></label><br>
    <input type="file" id="pdfFile" accept="application/pdf"><br>

    <label><b>Select Image File:</b></label><br>
    <input type="file" id="imgFile" accept="image/*"><br>

    <button class="btn" onclick="mergeFiles()">Merge PDF + Image</button>

</div>

<div class="output-box">
    <h3>Merged Output:</h3>
    <img id="finalImg" class="merged" src="">

    <br>

    <button class="btn" onclick="downloadMerged()">Download</button>

    <button class="btn" onclick="window.print()">Print</button>

    <button class="btn" onclick="sendWhatsapp()">WhatsApp Send</button>
</div>


<script>
let mergedDataUrl = "";

/* ------------------------------
   Convert PDF → Canvas Image
---------------------------------*/
function pdfToImage(pdfFile) {
    return new Promise((resolve) => {
        const fileReader = new FileReader();

        fileReader.onload = function () {
            const typedarray = new Uint8Array(this.result);

            pdfjsLib.getDocument(typedarray).promise.then(pdf => {
                pdf.getPage(1).then(page => {
                    const viewport = page.getViewport({ scale: 2 });

                    let canvas = document.createElement("canvas");
                    let ctx = canvas.getContext("2d");

                    canvas.height = viewport.height;
                    canvas.width = viewport.width;

                    page.render({ canvasContext: ctx, viewport: viewport }).promise.then(() => {
                        resolve(canvas);
                    });
                });
            });
        };

        fileReader.readAsArrayBuffer(pdfFile);
    });
}

/* ------------------------------
   Merge PDF Image + Uploaded Image
---------------------------------*/
async function mergeFiles() {
    const pdfInput = document.getElementById("pdfFile").files[0];
    const imgInput = document.getElementById("imgFile").files[0];

    if (!pdfInput || !imgInput) {
        alert("Please upload both PDF and Image!");
        return;
    }

    // Convert PDF → Canvas Image
    const pdfCanvas = await pdfToImage(pdfInput);

    // Load uploaded image
    const img = new Image();
    img.src = URL.createObjectURL(imgInput);

    img.onload = () => {
        const finalCanvas = document.createElement("canvas");
        const ctx = finalCanvas.getContext("2d");

        const width = pdfCanvas.width;
        const height = pdfCanvas.height + img.height + 20;

        finalCanvas.width = width;
        finalCanvas.height = height;

        // Draw PDF
        ctx.drawImage(pdfCanvas, 0, 0);

        // Draw Image under PDF
        ctx.drawImage(img, 0, pdfCanvas.height + 10);

        mergedDataUrl = finalCanvas.toDataURL("image/png");

        document.getElementById("finalImg").src = mergedDataUrl;
    };
}

/* ------------------------------
   Download Merged Image
---------------------------------*/
function downloadMerged() {
    if (!mergedDataUrl) {
        alert("Merge first!");
        return;
    }
    const a = document.createElement("a");
    a.href = mergedDataUrl;
    a.download = "merged_output.png";
    a.click();
}

/* ------------------------------
   WhatsApp Share (Image as Link)
---------------------------------*/
function sendWhatsapp() {
    if (!mergedDataUrl) {
        alert("Merge first!");
        return;
    }
    const encoded = encodeURIComponent(mergedDataUrl);
    const url = "https://wa.me/?text=" + encoded;
    window.open(url, "_blank");
}
</script>

</body>
</html>
